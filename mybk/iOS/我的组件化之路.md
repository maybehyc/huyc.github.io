# 我的组件化之路

这段时间发现公司项目耦合度高、拓展性差等缺点,于是领导们觉得对现有项目进行重构,目的是解耦、提高拓展性和可用性。虽然我没有参与这次项目的重构,但我本着对公司的奉献,想设计一套可用性高的架构。于是想起了前段时间看到的一个词 -- 组件化。

我司以前项目架构:
![](https://github.com/maybehyc/huyc.github.io/blob/master/mybk/iOS/images/index1.png)

这是我司以前项目架构,可以看出,模块间耦合度非常高,项目维护成本很高。
后来改过一版,架构如下：
![](https://github.com/maybehyc/huyc.github.io/blob/master/mybk/iOS/images/index2.png)

发现效果不明显,治标不治本,模块间耦合度还是非常的高。

现在项目要准备第二次重构了,重构的第一步是什么,项目架构的重构 -- 组件化,这是为以后打下坚实的基础。

我查阅了多方资料,起初,我受到服务端分层架构的影响,照搬用到客户端里去
![](https://github.com/maybehyc/huyc.github.io/blob/master/mybk/iOS/images/index3.png)

思路看上去很清晰,我也去试着实现demo,但当我真正去做的时候困难重重。首先不够彻底组件化,从APP的角度来讲还是一个整体,不能分离;其次每个服务都经过多层调用,实现和后期维护也存在多种问题;还有就是一些网络数据的回调方法不好实现。
基于上述原因,我放弃了此架构,又一朝回到解放前了。

我又开始查阅资料,当我看到一篇文章
https://www.cnblogs.com/oc-bowen/p/5885476.html
我得到的启发,组件化真正的意思:每个模块都能作为APP单独运行。
架构中有一个主工程,主工程负责集成所以组件,每个组件都是一个单独的工程,创建不同的git库来集成,这样每个组件都能并行开发,且相互不受影响。
![](https://github.com/maybehyc/huyc.github.io/blob/master/mybk/iOS/images/index4.png)

接下来我们就对每一层的组件技术选型进行说明

1.业务组件
业务组件分为UI层和逻辑层,要设计这一层,就要属当下最流行的三种设计模式:MVC、MVVM、MVP。
MVC:一种比较老的设计模式,对当时业务不适应。
MVVM:数据和视图双向绑定。
MVP:由MVC模式演变而来,做的真正的解耦。

具体使用哪种模式要视业务而定,个人推荐MVP模式。

2.容器组件
容器组件是贯穿整个应用的组件,当下有2个模块:应用生命周期模块和总线模块。

应用生命周期模块:如果简单的话可用AppDelegate代替,如果复杂的话可另起一个模块。
总线模块:分为URL总线、服务总线、消息总线。总线模块我是参考了以下博文
http://www.jianshu.com/p/afb9b52143d4
博文中讲述了总线设计的一套方案,类似于android的EventBus。

3.中间件模块
中间件模块是对一些SDK服务的封装,统一接口供业务层调用。你只需关注接口提供方法,无需关注SDK底层实现,配合容器组件进行透明开发。

4.基础模块
基础模块包括网络模块、缓存模块、图片模块等一些基础服务。提供接口,配合容器组件供业务层调用。

以上是项目重构的第一步，也是一小步。接下来我会学习《重构 改善既有代码的设计》这本书，来完成现有项目的重构。并且对现有项目的代码管理、测试流程、集成方面的一些优化。
