# 字典

## 定义
字典, 又称为符号表 关联数组或者映射,是一种保存键值对的抽象数据结构.
字典作为一种常用数据结构被内置在许多程序语言中,由于 C 语言没有内置这种数据结构, Redis 构建了自己的字典实现.

字典在 Redis 中的应用相当广泛, 比如 Redis 的数据库就是使用字典作为底层实现的, 对数据库的 增删改查操作也是构建在对字典的操作之上的.

除了用作数据库之外, 字典还是哈希键的底层之一, 当一个哈希键包含的键值对较多,欧哲键值对中的元素都是比较长的字符串时, Redis 就会使用字典作为哈希键的底层实现.

## 字典的实现

### 哈希表
Redis 字典所使用的哈希表由 dict.h/dictht 结构定义:

    typedef struct dictht {
    dictEntry **table;      //哈希表数组
    unsigned long size;     //哈希表大小
    unsigned long sizemask; //用于计算索引值,
    //总是等于 size - 1
    unsigned long used;     //哈希表已有节点数量
    }  dictht;
    
table 属性是一个数组, 数组中每个元素都是一个指向 dictEntry 结构的指针, 每个 dictEntry 结构保存着一个键值对.
size 属性记录了哈希表的大小,也就是 table 数组的大小
sizemask 属性和哈希值一起决定一个键应该被放到 table 数组的哪个索引上面

### 哈希表节点
哈希表节点使用 dictEntry 表示,每个 dictEntry 结构保存着一个键值对

    typedef struct dictEntry {
    void *key;          //键
    union {             //值
    void *val;
    uint_64 u64;
    int64_t s64;
    } v;                    
    sturct dictEntry *next; //指向下个哈希表节点,形成链表
    } dictEntry;
注意这里 v 属性保存着键值对中的值,其中的键值可以是指针,或是 uint_64 整数,又或者是 int64_t 整数.
next 属性是指向另一个哈希表节点的指针,这个指针将多个哈希值相同的键值对连接在一起,以此来解决键值冲突(collision)问题.

### 字典
Redis 中的字典 由 dict.h/dict 结构表示:

    typedef struct dict {
    dictType *type;     //类型特定函数
    void *privdata;     //私有数据
    dictht ht[2];       //哈希表
    int rehashdx;      //rehash 索引,当 rehash 不在进行时,值为-1
    } dict;
    
type 和 privdata 是针对不同类型的键值对,为创建多态字典而设置的
`type`指向一个 `dictType` 结构的指针, 每个` dictType` 结构保存了一簇用于操作特作特定类型键值对的函数, Redis 会为用途不同的字典设置不同的类型特定函数.

而` pridata` 则保存了需要传给那些特定类型函数看可选参数.
ht 属性,包含两个数组,数组的每一项都是一个 dictht 哈希表,一般情况下字典只使用ht[0] 哈希表,ht[1]哈希表只会在对哈希表进行 rehash 时使用.
rehashidex 记录了 rehash 当前的进度,如果没有进行 rehash, 值就为-1.

下图展示了一个普通状态下的字典(没有 rehash 进行)

## 哈希算法
